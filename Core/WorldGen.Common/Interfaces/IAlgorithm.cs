
using System;
using System.Collections.Generic;
using System.Reflection;
using WorldGen.Common.Enums;
using WorldGen.Utilities.Logger;

namespace WorldGen.Common.Interfaces
{
    /// <summary>
    /// 
    /// </summary>
    public abstract class IAlgorithm : ILoggable
    {
        #region FIELDS

        /// <summary>
        /// Flag to indicate if debug mode is set
        /// </summary>
        protected bool debugMode;

        /// <summary>
        /// Collection of map types that can be generated by this algorithm
        /// </summary>
        protected HashSet<MapTypes> outputMapList;

        #endregion

        #region PROPERTIES

        public bool DebugMode
        {
            get { return debugMode; }
            set { debugMode = value; }
        }

        #endregion

        #region METHODS

        /// <summary>
        /// Mass parameter initializer
        /// </summary>
        /// <param name="parameters">Array of parameters</param>
        public abstract void Initialize(BE.InitializeParams parameters);

        /// <summary>
        /// Sets a single parameter
        /// </summary>
        /// <param name="paramType"> Parameter type</param>
        /// <param name="value"> Parameter value</param>
        public abstract void SetParameter(AlgorithmParameters paramType, object value);

        /// <summary>
        /// Creates a map
        /// </summary>
        /// <returns>A map cretad by the algorithm</returns>
        public abstract IMap Create();

        #endregion

        #region ILOGGABLE


        protected override void WriteLogFunctionEnter(MethodBase method, params object[] values)
        {
            string logString = String.Empty;
            string paramValues = String.Empty;
            if(this.DebugMode)
            {
                paramValues = this.GetArrayObjectsString(method, values);
                logString = string.Format(  this.functionEnterBaseString,
                                            DateTime.Now.ToString("HHmmss"),
                                            this.GetType().Name,
                                            method.Name,
                                            paramValues);
                StaticLogger.WriteLog(logString);
            }
        }

        protected override void WriteLogFunctionExit(MethodBase method, object result)
        {
            string logString = String.Empty;
            string resultString = String.Empty;
            if(this.DebugMode)
            {
                resultString = this.GetResultObjectString(method, result);
                logString = string.Format(  this.functionExitBaseString,
                                            DateTime.Now.ToString("HHmmss"),
                                            this.GetType().Name,
                                            method.Name,
                                            resultString);
                StaticLogger.WriteLog(logString);
            }
        }

        protected override void WriteLogFunctionExit(MethodBase method)
        {
            string logString = String.Empty;
            string resultString = String.Empty;
            if(this.DebugMode)
            {
                logString = string.Format(  this.functionExitBaseString,
                                            DateTime.Now.ToString("HHmmss"),
                                            this.GetType().Name,
                                            method.Name,
                                            resultString);
                StaticLogger.WriteLog(logString);
            }
        }

        protected override void WriteLogError(MethodBase method, Exception ex)
        {
            string logString = String.Empty;
            logString = string.Format(  this.functionErrorBaseString,
                                        DateTime.Now.ToString("HHmmss"),
                                        this.GetType().Name,
                                        method.Name,
                                        ex.Message);
            StaticLogger.WriteLog(logString);
        }

        protected override void WriteLogMessage(MethodBase method, string message)
        {
            string logString = String.Empty;
            if(this.DebugMode)
            {
                logString = string.Format(  this.functionMessageBaseString,
                                            DateTime.Now.ToString("HHmmss"),
                                            this.GetType().Name,
                                            method.Name,
                                            message);
                StaticLogger.WriteLog(logString);
            }
        }

        protected override void WriteLogMessage(string message)
        {
            string logString = String.Empty;
            if(this.DebugMode)
            {
                logString = string.Format(  this.functionMessageBaseString,
                                            DateTime.Now.ToString("HHmmss"),
                                            this.GetType().Name,
                                            "",
                                            message);
                StaticLogger.WriteLog(logString);
            }
        }

        #endregion
    }
}
